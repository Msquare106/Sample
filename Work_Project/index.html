<html>
<head>
    <meta charset="utf-8" />
    <title>Location Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="container">
        <h2 class="text-center mt-4 mb-4">Data Display</h2>
        <div class="card">
            <div class="card-header"><b>Select Excel File</b></div>
            <div class="card-body">              
                <input type="file" id="excel_file" />
                <label for="excel_file">Import .xlsx</label>
                <i id="filename"></i>
            </div>
        </div>
        <div class="card">
            <div class="card-body ftr-container">
                <div class="ftr-sec1">
                    <div><b>Network Provider : </b>
                    <select name="netpro" id="netpro">
                        <option value="">--Select--</option>
                    </select></div>
                    <div><b>Zone : </b>
                    <select name="zone" id="zone">
                        <option value="">--Select--</option>
                    </select></div>
                    <div><b>State : </b>
                    <select name="state" id="state">
                        <option value="">--Select--</option>
                    </select></div>
                    <div><b>District : </b>
                    <select name="district" id="district">
                        <option value="">--Select--</option>
                    </select></div>
                </div>
                <div class="ftr-sec2">
                    <div><b>Block : </b>
                    <select name="block" id="block">
                        <option value="">--Select--</option>
                    </select></div>
                    <div><b>Vendor : </b>
                    <select name="vendor" id="vendor">
                        <option value="">--Select--</option>
                    </select></div>
                    <div><b>Tech Name : </b>
                    <select name="tecname" id="tecname">
                        <option value="">--Select--</option>
                    </select></div>
                </div>
            </div>
        </div>
        <div class="card-body">
            <button type="button" id="btn">Get Data</button>
        </div>
        <div id="title"></div>
    </div>
    <div id="excel_data" class="mt-5">
        <table class="table table-striped table-bordered" id="tb">
            
        </table>
    </div>
</body>
</html>
<script src="https://unpkg.com/read-excel-file@5.x/bundle/read-excel-file.min.js">
        
const data_file = document.getElementById('excel_file');

data_file.addEventListener('input', ()=>{
    document.getElementById('filename').innerHTML = data_file.files[0].name;

    // reading excel file
    readXlsxFile(data_file.files[0]).then((data)=>{
        // column retriever function
        function col_data(index){
            let col_list = [];
            data.forEach((item)=>{
                col_list.push(item[index]);
            })
            col_list = col_list.slice(4, col_list.length);
            col_list.pop();
            col_list = col_list.filter((unique, loc)=> col_list.indexOf(unique) === loc);
            return col_list
        }

        // filter options listing function
        function filter_opt_list(id, list){
            let select = document.getElementById(id);
            select.innerHTML = '<option value="">--Select--</option>';
            list.forEach((item)=>{
                let opt = document.createElement('option');
                opt.innerHTML = item;
                select.appendChild(opt);
            })
        }

        filter_opt_list('netpro', col_data(0));

        // select filter list elements
        let net_pro_list = document.getElementById('netpro');
        let zone_list = document.getElementById('zone');
        let state_list = document.getElementById('state');
        let dist_list = document.getElementById('district');
        let block_list = document.getElementById('block');
        let vendor_list = document.getElementById('vendor');
        let tecname_list = document.getElementById('tecname');

        // modify zone list based on network provider selection
        net_pro_list.addEventListener('change', ()=>{
            let mod_zone_list = [];
            data.forEach((item)=>{
                if(net_pro_list.value === item[0]){
                    mod_zone_list.push(item[1]);
                }
            })
            mod_zone_list = mod_zone_list.filter((unique, loc)=> mod_zone_list.indexOf(unique) === loc);
            filter_opt_list('zone',mod_zone_list);
            state_list.innerHTML = '<option value="">--Select--</option>';
            dist_list.innerHTML = '<option value="">--Select--</option>';
            block_list.innerHTML = '<option value="">--Select--</option>';
            vendor_list.innerHTML = '<option value="">--Select--</option>';
            tecname_list.innerHTML = '<option value="">--Select--</option>';
        })

        // modify state list based on zone selection
        zone_list.addEventListener('change', ()=>{
            let mod_state_list = [];
            data.forEach((item)=>{
                if(zone_list.value === item[1] && net_pro_list.value === item[0]){
                    mod_state_list.push(item[2]);
                }
            })
            mod_state_list = mod_state_list.filter((unique, loc)=> mod_state_list.indexOf(unique) === loc);
            filter_opt_list('state',mod_state_list);
            dist_list.innerHTML = '<option value="">--Select--</option>';
            block_list.innerHTML = '<option value="">--Select--</option>';
            vendor_list.innerHTML = '<option value="">--Select--</option>';
            tecname_list.innerHTML = '<option value="">--Select--</option>';
        })

        // modify district list based on state selection
        state_list.addEventListener('change', ()=>{
            let mod_district_list = [];
            data.forEach((item)=>{
                if(state_list.value === item[2] && zone_list.value === item[1] && net_pro_list.value === item[0]){
                    mod_district_list.push(item[3]);
                }
            })
            mod_district_list = mod_district_list.filter((unique, loc)=> mod_district_list.indexOf(unique) === loc);
            filter_opt_list('district',mod_district_list);
            block_list.innerHTML = '<option value="">--Select--</option>';
            vendor_list.innerHTML = '<option value="">--Select--</option>';
            tecname_list.innerHTML = '<option value="">--Select--</option>';
        })

        // modify block list based on district selection
        dist_list.addEventListener('change', ()=>{
            let mod_block_list = [];
            data.forEach((item)=>{
                if(dist_list.value === item[3] && state_list.value === item[2] && zone_list.value === item[1] && net_pro_list.value === item[0]){
                    mod_block_list.push(item[4]);
                }
            })
            mod_block_list = mod_block_list.filter((unique, loc)=> mod_block_list.indexOf(unique) === loc);
            filter_opt_list('block',mod_block_list);
            vendor_list.innerHTML = '<option value="">--Select--</option>';
            tecname_list.innerHTML = '<option value="">--Select--</option>';
        })

        // modify vendor list based on block selection
        block_list.addEventListener('change', ()=>{
            let mod_vendor_list = [];
            data.forEach((item)=>{
                if(block_list.value === item[4] && dist_list.value === item[3] 
                && state_list.value === item[2] && zone_list.value === item[1] && net_pro_list.value === item[0]){
                    mod_vendor_list.push(item[11]);
                }
            })
            mod_vendor_list = mod_vendor_list.filter((unique, loc)=> mod_vendor_list.indexOf(unique) === loc);
            filter_opt_list('vendor',mod_vendor_list);
            tecname_list.innerHTML = '<option value="">--Select--</option>';
        })

        // modify tecname list based on vendor selection
        vendor_list.addEventListener('change', ()=>{
            let mod_tecname_list = [];
            data.forEach((item)=>{
                if(vendor_list.value === item[11] && block_list.value === item[4] && dist_list.value === item[3] 
                    && state_list.value === item[2] && zone_list.value === item[1] && net_pro_list.value === item[0]){
                    mod_tecname_list.push(item[12]);
                }
            })
            mod_tecname_list = mod_tecname_list.filter((unique, loc)=> mod_tecname_list.indexOf(unique) === loc);
            filter_opt_list('tecname',mod_tecname_list);
        })

        // get filtered data function
        let btn = document.getElementById('btn');
        btn.addEventListener('click', ()=>{
            let tb = document.getElementById('tb');
            tb.innerHTML = '';
            
            for(let i=0;i<data.length;i++){
                var tr = document.createElement('tr');
                for(let j=0;j<data[i].length;j++){
                    if(i === 0){
                        var th = document.createElement('th');
                        th.innerHTML = data[i][j];
                        tr.appendChild(th);
                    }
                    else if(i===3){
                        var th = document.createElement('th');
                        th.innerHTML = data[i][j];
                        tr.appendChild(th);
                    }
                    else{
                        var td = document.createElement('td');
                        td.innerHTML = data[i][j];
                        tr.appendChild(td);
                    }
                }
                tb.appendChild(tr);
                if(i===3){break}
            }

            data.forEach((item)=>{
                var tr = document.createElement('tr');
                if(tecname_list.value === item[12] && vendor_list.value === item[11] && block_list.value === item[4] && dist_list.value === item[3] 
                    && state_list.value === item[2] && zone_list.value === item[1] && net_pro_list.value === item[0]){
                    for (let i=0;i<item.length;i++){
                        var td = document.createElement('td');
                        td.innerHTML = item[i];
                        tr.appendChild(td);
                    }
                }
                tb.appendChild(tr);
            })
        })
    })
})

    </script>
